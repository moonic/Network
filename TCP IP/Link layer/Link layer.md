# Link layer

* 为IP模块发送和接收IP数据报；
* 为ARP模块发送A RP请求和接收ARP应答；
* 为RARP发送RARP请求和接收RARP应答。TC/IP支持多种不同的链路层协议，取决于网络所使用的硬件
  * 如以太网、令牌环网、FDDI（光纤分布式数据接口）及R S-232串行线路等。


## 链路层协议
* 两个串行接口链路层协议（SLIP和PPP）
* 以及大多数实现都包含的环回（loopback）驱动程序。
* 以太网和SLIP是本书中大多数例子使用的链路层 对MTU（最大传输单元）这如何为串行线路选择 M T U。


## 以太网和IEEE 802封装

* 以太网这个术语一般是指数字设备公司英特尔公司和Xerox公司在1982年联合公布的一个标准它是TCP/IP采用的主要的局域网技术
 * 采用一种称作 CSMA/C D的媒体接入方法，其意思是带冲突检测的载波侦听多路接入（Carrier Sense, Multiple Access with Collision Detection）它的速率为10 Mb/s，地址为48 bit
* IEEE（电子电气工程师协会） 802委员会公布了一个稍有不同的标准集
  * 8023针对整个CSMA/CD网络
  * 802.4针对令牌总线网络
  * 802.5针对令牌环网络。
    * 这三者的共同特性由802.2标准来定义，那就是802网络共有的逻辑链路控制（LLC）
    * 不幸的是，802.2和802.3定义了一个与以太网不同的帧格式
      * 文献 [Stallings 1987]对所有的IEEE 802标准进行了详细的介绍
    
* TCP/IP中以太网
  * IP数据报封装是在RFC 894[Hornig 1984]中定义的
  * IEEE 802网络的IP数据报封装是在RFC 1042[Postel and Reynolds 1988]中定义的 
    1. 必须能发送和接收采用RFC 894（以太网）封装格式的分组。
    2. 应该能接收与RFC 894混合的RFC 1042（IEEE 802）封装格式的分组。
    3. 也许能够发送采用RFC 1042格式封装的分组 如果主机能同时发送两种类型的分组数据 
    4. 发送的分组必须是可以设置的而且默认条件下必须是 RFC 894分组
  * 常使用的封装格式是 RFC 894定义的格式
  * 802定义的有效长度值与以太网的有效类型值无一相同，这样，就可以对两种帧格式进行区分
  
*  在以太网帧格式中，类型字段之后就是数据；而在 8 0 2帧格式中，跟随在后面的是 3字节的802.2 LLC和5字节的802.2 SNAP。
 * 目的服务访问点（ Destination Service Access Point,DSAP）和源服务访问点（Source Service Access Point, SSAP)值都设为0xaaCtrl字段的值设为3。随后的3个字节orgcode都置为0。再接下来的2个字节类型字段和以太网帧格式一样（其他类型字段值可以参见RFC 1340
  * CRC字段用于帧内后续字节差错的循环冗余码检验（检验和）（它也被称为FCS或帧检验序列）。
 
 ---

* 尾部封装
 * RFC 893描述了另一种用于以太网的封装格式，称作尾部封装（trailer encapsulation）
 * 早期BSD系统在DEC VA X机上运行时的试验格式，它通过调整I P数据报中字段的次序来提高性能。
 * 以太网数据帧中，开始的那部分是变长的字段（IP首部和TCP首部）移到尾部（在 CR C之前）数据复制到内核时 可以把数据帧中的数据部分映射到一个硬件页面，节省内存到内存的复制过程。
 * TCP数据报的长度是52字节的整数倍，正好可以用内核中的页表来处理。两台主机通过协商使用 ARP扩展协议对数据帧进行尾部封装。这些数据帧需定义不同的以太网帧类型值
 
 ---
 
### SLIP：串行线路IP
> SLIP的全称是Serial Line IP。它是一种在串行线路上对I P数据报进行封装的简单形式
S L I P适用于家庭中每台计算机几乎都有的 R S - 2 3 2串行端口和高速调制解调器接入Internet
  * SLIP协议定义的帧格式
    1. IP数据报以一个称作END（0xc0）的特殊字符结束。同时，为了防止数据报到来之前的线路噪声被当成数据报内容，大多数实现在数据报的开始处也传一个 END字符（如果有线路噪声，那么E N D字符将结束这份错误的报文。这样当前的报文得以正确地传输，而前一个错误报文交给上层后，会发现其内容毫无意义而被丢弃
    2. 如果IP报文中某个字符为END那么就要连续传输两个字节0xdb和0xdc来取代0xdb这个特殊字符被称作SLIP的ESC字符但是它的值与ASCII码的ESC字符不同
    3. 如果IP报文中某个字符为S L I P的E S C字符，那么就要连续传输两个字节 0 x d b和0 x d d来取代它
* CSLIP(压缩的SLIP)
  * 串行线路的速率通常较低（19200 b/s或更低） 通信经常是交互式的（如Telnet和Rlogin，二者都使用TCP）
  * 因此在S L I P线路上有许多小的TCP分组进行交换 为了传送1个字节的数据需要20个字节的I P首部和20个字节的TCP首部，总数超过4 0个字节
 *  C S L I P一般能把上面的4 0个字节压缩到3或5个字节。它能在C S L I P的每一端维持多达16个T C P连接，并且知道其中每个连接的首部中的某些
字段一般不会发生变化


### PPP：点对点协议
* P P P 点对点协议修改了SLIP协议中的所有缺陷 PPP包括以下三个部分：

