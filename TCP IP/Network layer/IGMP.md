# IGMP(Internet组管理协议)
> 用于支持主机和路由器进行多播的Internet组管理协议（I G M P）
它让一个物理网络上的所有系统知道主机当前所在的多播路由器需要这些信息以便知道多播数据报应该向哪些接口转发
I G M P在RFC 111 2中定义 [Deering 1989]。正如 I C M P一样， I G M P也被当作 I P层的一部分
I G M P报文通过I P数据报进行传输。不像我们已经见到的其他协议， I G M P有固定的报文长度，没有可选数

## IGMP报文

* I G M P类型为1说明是由多播路由器发出的查询报文 主机发出的报告报文。检验和的计算和 I C M P协议相同。
* 组地址为D类I P地址。在查询报文中组地址设置为0在报告报文中组地址为要参加的组地址。
  

## IGMP 协议
* 加入一个多播组
  * 多播的基础就是一个进程的概念该进程在一个主机的给定接口上加入了一个多播组给定接口上的多播组中的成员是动态它随时因进程加入和离开多播组而变化。
  * 这里所指的进程必须以某种方式在给定的接口上加入某个多播组。进程也能离开先前加入的多播组。这些是一个支持多播主机中任何 A P I所必需的部分。
  * 使用限定词“接口”是因为多播组中的成员是与接口相关联的。一个进程可以在多个接口上加入同一多播组。
  
## IGMP 报告和查询
1. 当第一个进程加入一个组时，主机就发送一个 I G M P报告。如果一个主机的多个进程加
入同一组，只发送一个I G M P报告。这个报告被发送到进程加入组所在的同一接口上。
2. 进程离开一个组时，主机不发送 I G M P报告，即便是组中的最后一个进程离开。主机知
道在确定的组中已不再有组成员后，在随后收到的 I G M P查询中就不再发送报告报文。
3. 多播路由器定时发送I G M P查询来了解是否还有任何主机包含有属于多播组的进程。多
播路由器必须向每个接口发送一个 I G M P查询。因为路由器希望主机对它加入的每个多播组均
发回一个报告，因此I G M P查询报文中的组地址被设置为0。
4. 主机通过发送I G M P报告来响应一个I G M P查询，对每个至少还包含一个进程的组均要
发回I G M P报告。
  * 使用这些查询和报告报文，多播路由器对每个接口保持一个表，表中记录接口上至少还包含一个主机的多播组
  * 当路由器收到要转发的多播数据报时，它只将该数据报转发到（使用相应的多播链路层地址）还拥有属于那个组主机的接口上。
 
* 生存时间字段
  * IGMP报告和查询的生存时间 (TTL)均设置为1，这涉及到I P首部
中的T T L字段。一个初始T T L为0的多播数据报将被限制在同一主机。在默认情况下，待传多
播数据报的T T L被设置为1，这将使多播数据报仅局限在同一子网内传送。更大的 T T L值能被
多播路由器转发。
    * Traceroute程序它主要依据设置T T L值来完成。既然多播应用必须能够设置要传送数据报的TTL值
    这意味着程序设计接口必须为用户进程提供这种能力
    
## 小结
* 多播是一种将报文发往多个接收者的通信方式。在许多应用中，它比广播更好，因为多
播降低了不参与通信的主机的负担。简单的主机成员报告协议 ( I G M P )是多播的基本模块。
* 在一个局域网中或跨越邻近局域网的多播需要使用本章介绍的技术。广播通常局限在单
个局域网中，对目前许多使用广播的应用来说，可采用多播来替代广播。
* 多播还未解决的一个问题是在广域网内的多播。 [Deering and Cheriton 1990] 提出
扩展目前的路由协议来支持多播[Perlman 1992]讨论了广域网多播的一些问题。
* [Casner and Deering 1992] 介绍了使用多播和一个称为 M B O N E（多播主干）的虚拟网络
在整个Internet上传送I E T F会议的情况。

