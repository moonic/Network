# ping
* ping这个名字源于声纳定位操作Ping程序由Mike Muuss编写，主机是否可以发送一份ICMP回显请求报文给主机并等待返回ICMP回显应答
* Ping到某台主机不能Telnet或者FTP到那台主机如果不能Telnet到某台主机 可用 P i n g程序来确定问题出在哪里
* Ping测定往返时间，以表明该主机离我们有“多远”深入剖析 I C M P。P i n g还给我们提供了检测I P记录路由和时间戳选项的机会

* Ping程序
  * 发送回显请求的ping程序为客户称被ping的主机为服务器多数TCP/IP实现都在内核中直接支持 P i n g服务器 — 这种服务器不是一个用户进程
  * 其他类型的I C M P查询报文，服务器必须响应标识符和序列号字段。另外，客户发送的选项数据必须回显，假设客户对这些信息都会感兴趣。
  

*  LAN输出
  * 返回I C M P回显应答时，要打印出序列号和 T T L，并计算往返时间（ T T L位于I P首部中的生存时间字段。当前的 B S D系统中的p i n g程序每次收到回显应答时都打印出收到的 T T L— 有些系统并不这样做。
  * p i n g程序通过在I C M P报文数据中存放发送请求的时间值来计算往返时间。当应答返回时，用当前时间减去存放在 I C M P报文中的时间值，即是往返时间。
    * 注意，在发送端 b s d i上，往返时间的计算结果都为 0 ms。这是因为程序使用的计时器分辨率低的原因。 
  * B S D / 3 8 6版本0 . 9 . 4系统只能提供10 ms级的计时器（在附录B中有更详细的介绍）在具有较高分辨率计时器的系统上（ S u n）查看t c p d u m p输出时会发现，I C M P回显请求和回显应答的时间差在4 ms以下。输出的第一行包括目的主机的 I P地址，尽管指定的是它的名字（ s v r 4）。这说明名字已经经过解析器被转换成 I P地址了。我们将在第 1 4章介绍解析器和D N S果敲入p i n g命令，几秒钟过后会在第 1行打印出I P地址，D N S就是利用这段时间来确定主机名所对应的I P地址。

* 线路SLIP链接
  * S L I P链路上的往返时间，因为它们经常运行于低速的异步方式，如 9 6 0 0b / s或更低。回想我们在 2 . 1 0节计算的串行线路吞吐量。针对这个例子，我们把主机 b s d i和s l i p之间的S L I P链路传输速率设置为1200 b/s。
  1. 首先，从前面的 P i n g程序输出例子中可以注意到，默认情况下发送的I C M P报文有5 6个字节。再加上2 0个字节的I P首部和8个字节的I C M P首部，I P数据报的总长度为 8 4字节（我们可以运行 t c p d u m p-e命令查看以太网数据帧来验证这一点）。
  2. 至少要增加两个额外的字节：在数据报的开始和结尾加上 E N D字符。此外，S L I P帧还有可能再增加一些字节，但这取决于数据报中每个字节的值。对于 1200 b/s这个速率来说，由于每个字节含有 8 bit数据、1 bit起始位和1 bit结束位，因此传输速率是每秒1 2 0个字节，或者说每个字节 8.33 ms。以估计需要 1 4 3 3（8 6×8 . 3 3×2）m s（乘2是因为我们计算的是往返时间）。


* IP记录路由选项
以提供记录路由的功能。使 p i n g程序在发送出去的I P数据报中设置I PR R选项（该I P数据报包含I C M P回显请求报文）。这样，每个处理该数据报的路由器都把它的I P地址放入选项字段中。当数据报到达目的端时， I P地址清单应该复制到 I C M P回显应答中，这样返回途中所经过的路由器地址也被加入清单中。当 p i n g程序收到回显应答时，它就打印出这份I P地址清单。
  * 但存在一些缺陷。源端主机生成 R R选项，中间路由器对R R选项的处理，以及把I C M P回显请求中的R R清单复制到I C M P回显应答中，所有这些都是选项功能。幸运的是，现在的大多数系统都支持这些选项功能，只是有一些系统不把 I C M P请求中的I P清单复制到I C M P应答中。
  *  I P首部中只有有限的空间来存放 I P地址。我们从图3 - 1可以看到，I P首部中的首部长度字段只有 4 bit，因此整个I P首部最长只能包括1 5个32 bit长的字（即6 0个字节）。由于I P首部固定长度为 2 0字节，R R选项用去3个字节（下面我们再讨论），这样只剩下3 7个字节（ 6 0- 2 0- 3）来存放 I P地址清单，也就是说只能存放 9个I P地址。对于早期的A R PA N E T来说，9个I P地址似乎是很多了，


* IP时间戳选项
  * I P时间戳选项与记录路由选项类似。 I P时间戳选项的格式如图7 - 7所示（请与图7 - 3进行比较）。时间戳选项的代码为 0 x 4 4。其他两个字段 l e n和p r与记录路由选项相同：选项的总长度（一般为3 6或4 0）和指向下一个可用空间的指针（ 5，9，1 3等）。
  * 接下来的两个字段是4 bit的值：O F表示溢出字段，F L表示标志字段。时间戳选项的操作根据标志字段来进行，如图7 - 8所示。


## 小结
1. p i n g程序是对两个T C P / I P系统连通性进行测试的基本工具。它只利用 I C M P回显请求和
2. 回显应答报文，而不用经过传输层（ T C P / U D P）。P i n g服务器一般在内核中实现I C M P的功能。
3. 我们分析了在 L A N、WA N以及S L I P链路（拨号和线路）上运行 p i n g程序的输出结果，并对串行线路上的S L I P链路吞吐量进行了计算。我们还讨论并使用了 p i n g程序的I P记录路由选项。利用该I P选项，可以看到它是如何频繁使用默认路由的。在第 9章我们将再次回到这个讨论主题。另外，还讨论了IP 时间戳选项，但它在实际使用时有所限制。
