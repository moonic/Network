# ARP：地址解析协议
> 为I P地址到对应的硬件地址之间提供动态映射。我们之所以用动态这个词是因为这个过程是自动完成的 一般应用程序用户或系统管理员不必关心。
> 对 TCP/IP协议簇有意义的I P地址数据链路如以太网或令牌环网都有自己的寻址机制（常常为 48 bit地址）使用数据链路的任何网络层都必须遵从,
一个网络如以太网可以同时被不同的网络层使用
> 一台主机把以太网数据帧发送到位于同一局域网上的另一台主机时，是根据 48 bit的以太网地址来确定目的接口的。设备驱动程序从不检查 I P数据报中的目的I P地址。地址解析为这两种不同的地址形式提供映射

*  ftp bsdi
1) 应用程序FTP客户端调用函数g e t h o s t b y n a m e(3)把主机名（bsdi）转换成32 bit的IP地址。
这个函数在D N S（域名系统）中称作解析器，我们将在第1 4章对它进行介绍。这个转换
过程或者使用DNS，或者在较小网络中使用一个静态的主机文件（/e t c / h o s t s）。
2) F T P客户端请求T C P用得到的I P地址建立连接。
3) T C P发送一个连接请求分段到远端的主机，即用上述 I P地址发送一份 I P数据报（在第
1 8章我们将讨论完成这个过程的细节）。
4) 如果目的主机在本地网络上（如以太网、令牌环网或点对点链接的另一端），那么I P数
据报可以直接送到目的主机上。如果目的主机在一个远程网络上，那么就通过 I P选路
函数来确定位于本地网络上的下一站路由器地址，并让它转发 I P数据报。在这两种情
况下，I P数据报都是被送到位于本地网络上的一台主机或路由器。
5) 假定是一个以太网，那么发送端主机必须把 32 bit的I P地址变换成48 bit的以太网地址。
图4-1 地址解析协议：ARP
和RARP
32位Internet地址
48位以太网地址
bbs.theithome.com
第4章 ARP：地址解析协议使用 39
从逻辑I n t e r n e t地址到对应的物理硬件地址需要进行翻译。这就是 A R P的功能。
A R P本来是用于广播网络的，有许多主机或路由器连在同一个网络上。
6) A R P发送一份称作A R P请求的以太网数据帧给以太网上的每个主机。这个过程称作广
播，如图 4 - 2中的虚线所示。 A R P请求数据帧中包含目的主机的 I P地址（主机名为
b s d i），其意思是“如果你是这个I P地址的拥有者，请回答你的硬件地址。”
7) 目的主机的A R P层收到这份广播报文后，识别出这是发送端在寻问它的 I P地址，于是
发送一个A R P应答。这个A R P应答包含I P地址及对应的硬件地址。
8) 收到A R P应答后，使A R P进行请求—应答交换的I P数据报现在就可以传送了。
9) 发送I P数据报到目的主机。
在A R P背后有一个基本概念，那就是网络接口有一个硬件地址（一个 48 bit的值，标识不
同的以太网或令牌环网络接口）。在硬件层次上进行的数据帧交换必须有正确的接口地址。但
是，T C P / I P有自己的地址：32 bit的I P地址。知道主机的I P地址并不能让内核发送一帧数据给
主机。内核（如以太网驱动程序）必须知道目的端的硬件地址才能发送数据。 A R P的功能是
在32 bit的I P地址和采用不同网络技术的硬件地址之间提供动态映射。


## ARP高速缓存
* 每个主机上都有一个 A R P高速缓存。这个高速缓存存放了最
近I n t e r n e t地址到硬件地址之间的映射记录。高速缓存中每一项的生存时间一般为 2 0分钟，起
始时间从被创建时开始算起


## ARP的分组格式
> 在以太网上解析I P地址时，A R P请求和应答分组的格式如图 4 - 3所示（A R P可以用于其他
类型的网络，可以解析 I P地址以外的地址。紧跟着帧类型字段的前四个字段指定了最后四个
字段的类型和长度）。
