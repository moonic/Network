# NFS网络文件系统
> 它为客户程序提供透明的文件访问。N F S的基础是Sun RPC：远程过程调用。
 R P C:客户程序使用 N F S不需要做什么特别的工作，当 N F S内核检测到被访问的文件位于一个N F S服务器时，
 就会自动产生一个访问该文件的 R P C调用对它如何使用 I n t e r n e t的协议，尤其是U D P协议，

* Sun远程过程调用
  * 多数的网络程序设计都是编写一些调用系统提供的函数来完成特定的网络操作的应用程序。
  例如，一个函数完成 T C P的主动打开，另一个完成 T C P的被动打开，一个函数在一个T C P连接上发送数据，另一个设置特定的协议选项（如激活 T C P的k e e p a l i v e定时器）两个常用的用于网络编程的函数集（ A P I）：插口( s o c k e t )和T L I。正像客户端和
服务器端运行的操作系统可能会不相同一样，双方使用的 A P I也可能会不相同。由通信协议和应用协议决定一对客户和服务器是否可以彼此通信。如果两台主机连接在一个网络上，并且都有一个T C P / I P的实现，那么一台主机上的一个使用 C语言编写的、使用插口和T C P的U n i x客户程序可以和另一台主机上的一个使用 C O B O L语言编写的、使用其他 A P I和T C P的大型机服务器进行通信。
  * 客户发送命令给服务器，服务器向客户发送应答所有应用程序 — Ping，Traceroute，选路守护程序、以及 DNS、TFTP、BOOTP、SNMP、Telnet、FTP和SMTP的客户和服务器 — 都是采用这种方式实现的。远程过程调用RPC (Remote Procedure Call)是一种不同的网络程序设计方法。客户程序编写时只是调用了服务器程序提供的函数。这只是程序员所感觉到的，实际上发生了下面一些动作。
  1. 当客户程序调用远程的过程时，它实际上只是调用了一个位于本机上的、由 R P C程序包生成的函数这个函数被称为客户残桩（stub）客户残桩将过程的参数封装成一个网络报文，并且将这个报文发送给服务器程序。
  2. 服务器主机上的一个服务器残桩负责接收这个网络报文。它从网络报文中提取参数，然后调用应用程序员编写的服务器过程。
  3. 当服务器函数返回时，它返回到服务器残桩。服务器残桩提取返回值，把返回值封装成一个网络报文，然后将报文发送给客户残桩。
  4. 客户残桩从接收到的网络报文中取出返回值，将其返回给客户程序。
网络程序设计是通过残桩和使用诸如插口或 T L I的某个A P I的R P C库例程来实现的，但是
用户程序 — 客户程序和被客户程序调用的服务器过程 — 不会和这个A P I打交道。客户应用
程序只是调用服务器的过程，所有网络程序设计的细节都被 R P C程序包、客户残桩和服务器残桩所隐藏。

* 一个R P C程序包提供了很多好处。
  1. 程序设计更加容易，因为很少或几乎没有涉及网络编程。应用程序设计员只需要编写一个客户程序和客户程序调用的服务器过程。
  2. 如果使用了一个不可靠的协议，如 U D P，像超时和重传等细节就由 R P C程序包来处理。这就简化了用户应用程序。
  3. RPC库为参数和返回值的传输提供任何需要的数据转换。例如，如果参数是由整数和浮点数组成的，R P C程序包处理整数和浮点数在客户机和服务器主机上存储的不同形式。这个功能简化了在异构环境中的客户和服务器的编码问题。
  * R P C程序设计的细节可以参看参考文献 [Stevens 1990]的第1 8章。两个常用的R P C程序包是Sun RPC和开放软件基金（O S F）分布式计算环境（DCE）的R P C程序包。对于R P C的兴趣在于想了解Sun RPC中过程调用和过程返回报文的形式，因为本章中讨论的网络文件系统使用了它们。Sun RPC的第2版定义在RFC 1057 [Sun Microsystems 1988a]中。

* Sun RPC
  * Sun RPC有两个版本。一个版本建立在插口A P I基础上，和T C P和U D P打交道
  * 另一个称为 T I - R P C的（独立于运输层），建立在TLI API基础上，可以和内核提供的任何运输层协议打交道。T C P和U D P，从讨论的观点来看，两者是一样的。

* XDR: 外部数据表示
  * 外部数据表示XDR (eXternal Data Representation)是一个标准，用来对R P C调用报文和应
答报文中的值进行编码。这些值包括 R P C首部字段（X I D、程序号、接受状态等）、过程参数
和过程结果。采用标准化的方法对这些值进行编码使得一个系统中的客户可以调用另一个不
同架构的系统中的一个过程。X D R在RFC 1014中定义[Sun Microsystems 1987]。
  * X D R定义了很多数据类型以及它们如何在一个 R P C报文中传输的具体形式（如比特顺序，
字节顺序等）。发送者必须采用X D R格式构造一个R P C报文，然后接收者将X D R格式的报文转
换为本机的表示形式。例如，在图2 9 - 1和图2 9 - 2中，我们显示的所有整数值（X I D、调用字段、
程序号等）都是4字节的整数。在X D R中，所有的整数的确占据 4个字节。X D R支持的其他数
据类型包括无符号整数、布尔类型、浮点数、定长数组、可变长数组和结构。



