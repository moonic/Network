# FTP：文件传送协议
> 用于文件传输的 I n t e r n e t标准。我们必须分清文件传送（file transfer）和文件存取 (file access)之间的区别，前者是 F T P提供的，后者是如 N F S等应用系统提供的。由 F T P提供的文件传送是将一个完整的文件从一个系统复制到另一个系统中。
要使用 F T P，就需要有登录服务器的注册帐号，或者通过允许匿名F T P的服务器来使用,
> Te l n e t类似，F T P最早的设计是用于两台不同的主机，这两个主机可能运行在不同的操作系统下、使用不同的文件结构、并可能使用不同字符集。但不同的是，Te l n e t获得异构性是强制两端都采用同一个标准：使用7比特ASCII码的N V T。而F T P是采用另一种方法来处理不同系统间的差异。F T P支持有限数量的文件类型（A S C I I，二进制，等等）和文件结构（面向字节流或记录）。参考文献959 [Postel 和 Reynolds 1985] 是F T P的正式规范。该文献叙述了近年来文件传输的历史演变


* FTP协议
  * F T P与我们已描述的另一种应用不同，它采用两个 T C P连接来传输一个文件。
  1. 控制连接以通常的客户服务器方式建立。服务器以被动方式打开众所周知的用于
F T P的端口（2 1），等待客户的连接。客户则以主动方式打开 T C P端口2 1，来建立连
接。控制连接始终等待客户与服务器之间的通信。该连接将命令从客户传给服务器，
并传回服务器的应答。
由于命令通常是由用户键入的，所以I P对控制连接的服务类型就是“最大限度地减小迟延”。
  2. 每当一个文件在客户与服务器之间传输时，就创建一个数据连接。（其他时间也可以创
建，后面我们将说到）。
由于该连接用于传输目的，所以I P对数据连接的服务特点就是“最大限度提高吞吐量”。
图2 7 - 1描述了客户与服务器以及它们之间的连接情况
从图中可以看出，交互式用户通常不处理在控制连接中转换的命令和应答。这些细节均
由两个协议解释器来完成。标有“用户接口”的方框功能是按用户所需提供各种交互界面
（全屏幕菜单选择，逐行输入命令，等等），并把它们转换成在控制连接上发送的 F T P命令。
类似地，从控制连接上传回的服务器应答也被转换成用户所需的交互格式。
从图中还可以看出，正是这两个协议解释器根据需要激活文件传送功能。


## F T P协议规范提供了控制文件传送与存储的多种选择

1. 文件类型
(a) ASCII码文件类型 （默认选择）文本文件以NVT ASCII码形式在数据连接中传输。这要求
发方将本地文本文件转换成NVT ASCII码形式，而收方则将NVT ASCII码再还原成本地文本文件。
其中，用NVT ASCII码传输的每行都带有一个回车，而后是一个换行。这意味着收方必须扫描每
个字节，查找C R、L F对（我们在第1 5 . 2节见过的关于T F I P的A S C I I码文件传输情况与此相同）。
(b) EBCDIC文件类型 该文本文件传输方式要求两端都是 E B C D I C系统。
(c) 图像文件类型（也称为二进制文件类型） 数据发送呈现为一个连续的比特流。通常
用于传输二进制文件。
(d) 本地文件类型 该方式在具有不同字节大小的主机间传输二进制文件。每一字节的比特
数由发方规定。对使用8 bit字节的系统来说，本地文件以8 bit字节传输就等同于图像文件传输。
2. 格式控制
该选项只对A S C I I和E B C D I C文件类型有效。
(a) 非打印 （默认选择）文件中不含有垂直格式信息。
(b) 远程登录格式控制 文件含有向打印机解释的远程登录垂直格式控制。
(c) Fortran 回车控制 每行首字符是F o r t r a n格式控制符。
3. 结构
（a） 文件结构 （默认选择）文件被认为是一个连续的字节流。不存在内部的文件结构。
（b） 记录结构 该结构只用于文本文件（A S C I I或E B C D I C）。
（c） 页结构 每页都带有页号发送，以便收方能随机地存储各页。该结构由 TO P S - 2 0操
作系统提供（主机需求R F C不提倡采用该结构）。
4. 传输方式
它规定文件在数据连接中如何传输。
（a） 流方式 （默认选择）文件以字节流的形式传输。对于文件结构，发方在文件尾提
示关闭数据连接。对于记录结构，有专用的两字节序列码标志记录结束和文件结束。
（b） 块方式 文件以一系列块来传输，每块前面都带有一个或多个首部字节。
（c） 压缩方式 一个简单的全长编码压缩方法，压缩连续出现的相同字节。
在文本文件中常用来压缩空白串，在二进制文件中常用来压缩 0字节（这种方式很少使用，也不受支持。
现在有一些更好的文件压缩方法来支持 F T P）。
如果算一下所有这些选择的排列组合数，那么对传输和存储一个文件来说就有 7 2种不同的方式。

* 通常由U n i x实现的FTP 客户和服务器把我们的选择限制如下：
  * 类型：A S C I I或图像。
  * 格式控制：只允许非打印。
  * 结构：只允许文件结构。
  * 传输方式：只允许流方式。
  * 这就限制我们只能取一、两种方式： A S C I I或图像（二进制）。
该实现满足主机需求 R F C的最小需求（该 R F C也要求能支持记录结构，但只有操作系统
支持它才行，而U n i x不行）。
  * 很多非U n i x的实现提供了处理它们自己文件格式的 F T P功能。主机需求R F C指出“F T P协
议有很多特征，虽然其中一些通常不实现，但对 F T P中的每一个特征来说，都存在着至少一种
实现”。


* FTP命令
命令和应答在客户和服务器的控制连接上以 NVT ASCII码形式传送。这就要求在每行结
尾都要返回C R、L F对（也就是每个命令或每个应答）。
从客户发向服务器的 Te l n e t命令（以I A C打头）只有中断进程（ < I A C , I P >）和Te l n e t的同
步信号（紧急方式下 < I A C , D M >）。我们将看到这两条 Te l n e t命令被用来中止正在进行的文件
传输，或在传输过程中查询服务器。另外，如果服务器接受了客户端的一个带选项的 Te l n e t命
令（W I L L，W O N T，D O或D O N T），它将以DONT 或W O N T响应。
这些命令都是3或4个字节的大写A S C I I字符，其中一些带选项参数。从客户向服务器发送
的F T P命令超过3 0种。图2 7 - 2给出了一些常用命令，其中大部分将在本章再次遇到。

