# SNMP: 简单网络管理协议
> 基于T C P / I P的网络管理包含两个部分：网络管理站（也叫管理进程， m a n a g e r）和被管的网络单元（也叫被管设备）
例如：路由器、 X 终端、终端服务器和打印机等,运行 T C P / I P协议管理进程和代理进程之间的通信可以有两种方式
一种是管理进程向代理进程发出请求，询问一个具体的参数值，另外一种方式是代理进程主动向管理进程报告有某些重要的事件发生管理进程除了可以向代理进程询问某些参数值以外，它还可以按要求改变代理进程的参数值


* 基于T C P / I P的网络管理包含3个组成部分：
  1. 一个管理信息库M I B（Management Information Base）。管理信息库包含所有代理进程
的所有可被查询和修改的参数。 RFC 1213 [McCloghrie and Rose 1991]定义了第二版的M I B，
叫做M I B - I I。
  2. 关于 M I B的一套公用的结构和表示符号。叫做管理信息结构 S M I（Structure of
Management Information）。这个在RFC 1155 [Rose and McCloghrie 1990] 中定义。例如：S M I
定义计数器是一个非负整数，它的计数范围是 0~4 294 967 295，当达到最大值时，又从0开始计数。
  3. 管理进程和代理进程之间的通信协议，叫做简单网络管理协议 S N M P（Simple Network
Management Protocol）。在RFC 1157 [Case et al. 1990]中定义。S N M P包括数据报交换的格式
等。尽管可以在运输层采用各种各样的协议，但是在 S N M P中，用得最多的协议还是U D P。

* 协议  
  1. g e t - r e q u e s t操作：从代理进程处提取一个或多个参数值。
  2. g e t - n e x t - r e q u e s t操作：从代理进程处提取一个或多个参数的下一个参数值
  3. s e t - r e q u e s t操作：设置代理进程的一个或多个参数值。
  4. g e t - r e s p o n s e操作：返回的一个或多个参数值。这个操作是由代理进程发出的。它是前面3中操作的响应操作。
  5. t r a p 操作：代理进程主动发出的报文，通知管理进程有某些事情发生。前面的3个操作是由管理进程向代理进程发出的。后面两个是代理进程发给管理进程的
  * 前 4种操作是简单的请求 -应答方式（也就是管理进程发出请求，代理
进程应答响应），而且在S N M P中往往使用U D P协议，所以可能发生管理进程和代理进程之间
数据报丢失的情况。因此一定要有超时和重传机制。
  * 管理进程发出的前面 3种操作采用U D P的1 6 1端口。代理进程发出的 Tr a p操作采用U D P的
1 6 2端口。由于收发采用了不同的端口号，所以一个系统可以同时为管理进程和代理进程
  * 在g e t、g e t - n e x t和s e t的请求数据报中，包含变量名称和变量值的一张表。对于 g e t
和g e t - n e x t操作，变量值部分被忽略，也就是不需要填写。对于t r a p操作符（P D U类型是4），S N M P报文格式有所变化。

* 管理信息结构
  * INTEGER。一个变量虽然定义为整型，但也有多种形式。有些整型变量没有范围限制，有些整型变量定义为特定的数值（例如，I P的转发标志就只有允许转发时的1或者不允许转发时的2这两种），有些整型变量定义为一个特定的范围（例如，U D P和T C P的端口号就从0到6 5 5 3 5）。
  * DisplayString。0或多个8 bit字节，但是每个字节必须是 A S C I I码（2 6 . 4中有A S C I I字符集）。在M I B - I I中，所有该类型的变量不能超过2 5 5个字符（0个字符是可以的）。
  * NULL。代表相关的变量没有值。例如，在 g e t或g e t - n e x t操作中，变量的值就是N U L L，因为这些值还有待到代理进程处去取。
  * IpAddress。4字节长度的OCTER STRING，以网络序表示的 I P地址。每个字节代表I P地址的一个字段。
  * PhysAddress OCTER STRING类型，代表物理地址（例如以太网物理地址为 6个字节长度）。
  * Counter非负的整数，可从0递增到 23 2 -1（4 294 976 295）。达到最大值后归0。
  * Gauge非负的整数，取值范围为从 0到4 294 976 295(或增或减)。达到最大值后锁定,直到复位。例如，M I B中的t c p C u r r E s t a b就是这种类型的变量的一个例子，它代表目前在E S TA B L I S H E D或C L O S E _ WA I T状态的T C P连接数。
  * T i m e T i c k s。时间计数器, 以0 . 0 1秒为单位递增，但是不同的变量可以有不同的递增幅度。
  所以在定义这种类型的变量的时候，必须指定递增幅度。例如，MIB中的sysUpTime变量就是这种类型的变量，代表代理进程从启动开始的时间长度，以多少个百分之一秒的数目来表示。

* 对象标识符
  * 对象标识是一种数据类型，它指明一种“授权”命名的对象。“授权”的意思就是这些标
识不是随便分配的，它是由一些权威机构进行管理和分配的。
对象标识是一个整数序列，以点（“.”）分隔。这些整数构成一个树型结构，类似于 D N S
（图1 4 - 1）或U n i x的文件系统。对象标识从树的顶部开始，顶部没有标识，以 r o o t表示（这和
U n i x中文件系统的树遍历方向非常类似）。
  * 树上的每个结点同时还有一个文字名例如标识1.3.6.1.2.1就和iso.org.dod.internet.memt.mib对应。
  *  AssignedNumber RFC中列出了在该结点下大约4 0 0个标识。
  * 深入讲解 M I B的时候，这些 C a s e图被用来验证：分组的所有数据路径都是被计数的。
[Rose 1994] 中显示了所有M I B组的C a s e图。

* 简单变量  
  * 通过在其对象标识后面添加“ . 0”来处理的。例如图2 5 - 8中的
计数器udpInDatagrams，它的对象标识是1.3.6.1.2.1.7.1，它的实例标识是1.3.6.1.2.1.7.1 . 0，相对应的文字名称是i s o . o r g . d o d . internet.mgmt.mib.udp.udpInDatagrams . 0。
  * 虽然这个变量处理后通常可以缩写为 udpInDatagrams  0，但我们还是要提醒读者在S N M P报文中该变量的名称是其对象的标识1.3.6.1.2.1.7.1.0
  
* 表格
  * 表格的实例标识就要复杂得多。回顾一下图 2 5 - 8中的UDP 监听表。
每个M I B中的表格都指明一个以上的索引。对于 U D P监听表来说，M I B定义了包含两个变量的联合索引，这两个变量是：u d p L o c a l A d d r e s s，它是一个I P地址；u d p L o c a l P o r t，它是一个整数（在图2 5 - 9中的第1行就显示了这个索引）。
  * 假设在U D P监听表中有3行具体成员：第1行的I P地址是0 . 0 . 0 . 0，端口号是6 7；第2行的I P地址是0 . 0 . 0 . 0，端口号是1 6 1；第3行的I P地址是0 . 0 . 0 . 0，端口号是5 2 0。
  * 如这意味着系统将从端口 6 7（B O O T P服务器）、端口1 6 1（S N M P）和端口 5 2 0（R I P）接受来自任何接口的U D P数据报。表格中的这 3行经过处理后的结果在图 2 5 -1 2中显示。
