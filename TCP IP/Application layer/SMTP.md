# SMTP 简单邮件传送协议
> 电子邮件（e - m a i l）无疑是最流行的应用程序。[Caceres et al.1991]说明，
所有T C P连接中大约一半是用于简单邮件传送协议 SMTP (Simple Mail Transfer Protocol)的（以比特计算为基础
F T P连接传送更多的数据）。[Paxson 1993] 发现，平均每个邮件中包含大约1 5 0 0字节的数据，但有的邮件中包含兆比特的数据，因为有时电子邮件也用于发送文件。


* SMTP协议
  * 两个M TA之间用NVT ASCII进行通信。客户向服务器发出命令，服务器用数字应答码和
可选的人可读字符串进行响应。这与上一章的 F T P类似。
  * 客户只能向服务器发送很少的命令：不到 1 2个（相比较而言，F T P超过4 0个）。我们用简
单的例子说明发送邮件的工作过程，并不仔细描述每个命令。

* SMTP命令
最小S M T P实现支持 8种命令。我们在前面的例子中遇到 5个：H E L O，M A I L，R C P T，
D ATA和Q U I T。
R S E T命令异常中止当前的邮件事务并使两端复位。丢掉所有有关发送方、接收方或邮件
的存储信息。
V R F Y命令使客户能够询问发送方以验证接收方地址，而无需向接收方发送邮件。通常是
系统管理员在查找邮件交付差错时手工使用的。我们将在下一节中给出这方面的例子。
N O O P命令除了强迫服务器响应一个O K应答码（2 0 0）外，不做任何事情。
还有附加和可选命令。 E X P N扩充邮件表，与 V R F Y类似，通常是由系统管理员使用的。
事实上，许多S e n d m a i l的版本都把这两者等价地处理。
T U R N命令使客户和服务器交换角色，无需拆除 T C P连接并建立新的连接就能以相反方向
发送邮件（S e n d m a i l不支持这个命令）。其他还有三个很少被实现的命令（ S E N D、S O M L和
S A M L）取代M A I L命令。这三个命令允许邮件直接发送到客户终端（如果已注册）或发送到
接收方的邮箱。

* 信封、首部和正文
电子邮件由三部分组成：
1) 信封（e n v e l o p e）是M TA用来交付的。在我们的例子中信封由两个 S M T P命令指明：
MAIL From: <rstevens@sun.tuc.noao.edu>
RCPT To: <estevens@noao.edu>
RFC 821指明了信封的内容及其解释，以及在一个 T C P连接上用于交换邮件的协议。
2) 首部由用户代理使用。在我们的例子中可以看到 9个首部字段： R e c e i v e d、
M e s s a g e - I d、F r o m、D a t a、R e p l y - T o、X - P h o n e、X - M a i l e r、T o和S u b j e c t。每个
首部字段都包含一个名，紧跟一个冒号，接着是字段值。 RFC 822指明了首部字段的格式的解
释（以X-开始的首部字段是用户定义的字段，其他是由 RFC 822定义的）。长首部字段，如例
子中的R e c e i v e d，被折在几行中，多余行以空格开头。
3) 正文（b o d y）是发送用户发给接收用户报文的内容。 RFC 822 指定正文为NVT ASCII
文字行。当用D ATA命令发送时，先发送首部，紧跟一个空行，然后是正文。用 D ATA命令发
送的各行都必须小于1 0 0 0字节。
用户接收我们指定为正文的部分，加上一些首部字段，并把结果传到 M TA。M TA加上一
些首部字段，加上信封，并把结果发送到另一个 M TA。
内容（c o n t e n t）通常用于描述首部和正文的结合。内容是客户用 D ATA命令发送的。

* 中继代理
简化了除中继系统 M TA外的其他所有M TA的配置（所有曾
使用过S e n d m a i l的人都能证明，配置一个M TA并不简单）。第二，它允许某个机构中的一个系
统作为邮件集线器，从而可能把其他所有系统隐藏起来。

* NVT ASCII
S M T P的一个特色是它用NVT ASCII表示一切：信封、首部和正文。正如我们在 2 6 . 4节中
谈到的，这是一个7 bit的字符码，以8 bit字节发送，高位比特被置为0。
在2 8 . 4节中，我们讨论了 I n t e r n e t邮件的一些新特性、允许发送和接收诸如音频和视频数
据的扩充S M T P和多媒体邮件（M I M E）。我们将看到，M I M E和NVT ASCII一起表示信封、首
部和正文，只需对用户代理作一些改变。

## 小结
* 电子邮件包括在两端（发送方和接收方）都有的一个用户代理以及两个或多个报文传送代理。可以把一个邮件报文分成三个部分：信封、首部和正文。我们已经看到这三个部分用S M T P和I n t e r n e t标准是如何进行交换的。所有都作为 NVT ASCII字符进行交换。
* 用于信封和非 A S C I I首部的扩充S M T P，以及使用M I M E的正文增加了结构。M I M E的结构和编码允许使用已有的7bit SMTP MTA交换任意二进制数据。

